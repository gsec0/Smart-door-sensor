<!DOCTYPE html>
<html>
<head>
<title>Garage Security System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    html {
        height: 100%;
    }

    body {
        height: 100%;
        margin: 0;
        font-family: "Roboto", "Arial", sans-serif, "Open Sans";
        display: grid;
        grid-template-rows: 2fr 16fr 3fr;
        user-select: none;
        -moz-user-select: none;
    }

    #wrapper {
        grid-row: 2;
        height: 100%;
        display: grid;
        grid-template-rows: 1fr 1fr;
        grid-row-gap: 10%;
    }

    .text {
        font-style: italic;
        margin: 0;
        text-align: center;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 15vmin;
        transition: font-size 0.02s ease-in;
    }

    .boxes {
        width: 70%;
        left: 15%;
        overflow: hidden;
        text-overflow: ellipsis;
        position: relative;
    }

    #button {
        color: white;
        border-style: solid;
        border-width: 2px;
        background-color: #dd3535;
        border-radius: 2vmin;
        cursor: pointer;
        transition: background-color 0.1s ease;
    }
    
    #button:hover {
        background-color: #fc4444;
    }

    #button:active > p {
        font-size: 12vmin;
    }

    #statusText {
        font-size: 8vmin;
    }
    
    #botBox {
        font-weight: 300;
        grid-row: 3;
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        grid-template-rows: repeat(3, 1fr);
        position: relative;
    }

    #div1 {
        grid-area: 2 / 1 / 4 / 2;
    }
    
    #div2 {
        grid-area: 2 / 2 / 4 / 3;
    }
    
    #div3 {
        grid-area: 2 / 3 / 4 / 4;
    }
    
    #div1, #div2, #div3 {
        transition: background-color 0.1s ease;
    }
    
    #div4 {
        grid-area: 1 / 1 / 2 / 4;
        border-bottom: solid 1px;
    }
    
    #div5 {
        grid-area: 1 / 5 / 4 / 7;
        background-color: #4c4c4c;
        color: white;
        transition: background-color 0.1s ease;
        margin: 1vmin;
        border-radius: 1vmin;
    }
    
    #div5:hover {
        background-color: #7a7a7a;
        cursor: pointer;
    }
    
    #div1:hover, #div2:hover, #div3:hover {
        color: white;
        background-color: #a0a0a0 !important;
        cursor: pointer;
    }
    
    .modeText {
        text-align: center;
        font-size: 3vh;
        width: 100%;
        margin: 0;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        position: absolute;
    }
    
    .menuBox {
        position: relative;
        overflow: hidden;
    }
    
    #settingText {
        font-size: 3.5vh;
    }
    
    #schedBox {
        text-align: center;
        grid-row: 1;
        font-weight: 300;
        font-size: 3vh;
    }
</style>
</head>
<body>
    <div id="schedBox">
        Schedule start: <span id="schedStart">...</span><br>
        Schedule end: <span id="schedEnd">...</span>
    </div>
    <div id="wrapper">
        <div class="boxes" id="button" onclick="toggle()"><p class="text">ALERT<br>OFF</p></div>
        <div class="boxes"><p class="text" id="statusText">...</p></div>
    </div>
    <div id="botBox">
        <div id="div1" class="menuBox" onclick="giveMode(1)"><p class="modeText">ON</p></div>
        <div id="div2" class="menuBox" onclick="giveMode(0)"><p class="modeText">OFF</p></div>
        <div id="div3" class="menuBox" onclick="giveMode(2)"><p class="modeText">AUTO</p></div>
        <div id="div4" class="menuBox"><p class="modeText">Pick a mode:</p></div>
        <div id="div5" class="menuBox" onclick="advSettings()"><p class="modeText" id="settingText">Advanced settings</p></div>
    </div> 
    <script>
        function pageLoad() {
            var getMode = new XMLHttpRequest();
            getMode.open("GET", "/getMode", true);
            getMode.onload = function() {
                if (this.status == 200) {
                    if (this.responseText == "1") {
                        document.getElementById("div1").style.backgroundColor = "#5ff959";
                        document.getElementById("div2").style.backgroundColor = "initial";
                        document.getElementById("div3").style.backgroundColor = "initial";
                    } else if (this.responseText == "0") {
                        document.getElementById("div1").style.backgroundColor = "initial";
                        document.getElementById("div2").style.backgroundColor = "#5ff959";
                        document.getElementById("div3").style.backgroundColor = "initial";
                    }  else if (this.responseText == "2") {
                        document.getElementById("div1").style.backgroundColor = "initial";
                        document.getElementById("div2").style.backgroundColor = "initial";
                        document.getElementById("div3").style.backgroundColor = "#5ff959";
                    }
                }
            };
            getMode.send();
            
            var getSched = new XMLHttpRequest();
            getSched.open("GET", "/getSched", true);
            getSched.onload = function() {
                if (this.status == 200) {
                    var schedTime = this.responseText.split('/');
                    var startSched = schedTime[0].split(':');
                    var endSched = schedTime[1].split(':');
                    var startTime = (startSched[0]<10?"0"+startSched[0]:startSched[0])+":"+(startSched[1]<10?"0"+startSched[1]:startSched[1]);
                    var endTime = (endSched[0]<10?"0"+endSched[0]:endSched[0])+":"+(endSched[1]<10?"0"+endSched[1]:endSched[1]);
                    document.getElementById("schedStart").innerHTML = startTime;
                    document.getElementById("schedEnd").innerHTML = endTime;
                }
            };
            getSched.send();
            
            var today = new Date();
            var h = today.getHours();
            var m = today.getMinutes();
            var s = today.getSeconds();
            h = checkTime(h);
            m = checkTime(m);
            s = checkTime(s);
            var timePayload = "hour="+h+"&minute="+m+"&second="+s;

            var sendTime = new XMLHttpRequest();
            sendTime.open("PUT", "/time", true);
            sendTime.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            sendTime.send(timePayload);
        };
        
        function checkTime(i) {
            if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
            return i;
        };
    
        window.onload = pageLoad;
        
        function receiveStatus() {
            var getStat = new XMLHttpRequest();
            getStat.open("GET", "/update", true);
            getStat.timeout = 2500;
            getStat.onload = function() {
                if (this.status == 200) {
                  document.getElementById("statusText").innerHTML = this.responseText;
                }
            };
            getStat.ontimeout = function() {
                document.getElementById("statusText").innerHTML = "OFFLINE";
            };
            getStat.send();
            
            setTimeout(receiveStatus, 250);
        };
        
        document.addEventListener('DOMContentLoaded', receiveStatus, false);
        
        function toggle() {
            var onCall = new XMLHttpRequest();
            onCall.open("PUT", "/toggle", true);
            onCall.send();
        };

        function giveMode(choice) {
            var modeVar = choice;
            var modePayload = "theMode=" + modeVar;
            if (modeVar == 1) { // turn ON
                document.getElementById("div1").style.backgroundColor = "#5ff959";
                document.getElementById("div2").style.backgroundColor = "initial";
                document.getElementById("div3").style.backgroundColor = "initial";
            } else if (modeVar == 0) { // turn OFF
                document.getElementById("div1").style.backgroundColor = "initial";
                document.getElementById("div2").style.backgroundColor = "#5ff959";
                document.getElementById("div3").style.backgroundColor = "initial";
            } else if (modeVar == 2) { // turn AUTO
                document.getElementById("div1").style.backgroundColor = "initial";
                document.getElementById("div2").style.backgroundColor = "initial";
                document.getElementById("div3").style.backgroundColor = "#5ff959";
            }

            var sendMode = new XMLHttpRequest();
            sendMode.open("PUT", "/giveMode", true);
            sendMode.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            sendMode.send(modePayload);
        };
        
        function advSettings() {
            window.location.href = "/settings";
        };
    </script>
</body>
</html>